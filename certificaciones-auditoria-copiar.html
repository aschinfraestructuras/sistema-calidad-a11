<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificaciones de Auditor√≠a - Sistema Integral</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideInUp 0.8s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .logo {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: bold;
            font-size: 18px;
            animation: logoGlow 3s ease-in-out infinite;
            min-width: 120px;
        }

        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,255,255,0.3); }
            50% { box-shadow: 0 0 30px rgba(255,255,255,0.6); }
        }

        .title-section {
            flex: 1;
            text-align: center;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #9b59b6;
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #9b59b6;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: 'üèÜ';
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #9b59b6;
            box-shadow: 0 0 0 3px rgba(155, 89, 182, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #9b59b6;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .metric-number {
            font-size: 32px;
            font-weight: bold;
            color: #9b59b6;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .signature-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .signature-box {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px dashed #9b59b6;
        }

        .signature-line {
            border-bottom: 2px solid #333;
            margin: 40px 0 10px 0;
            height: 2px;
        }

        .auto-save {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .auto-save.show {
            opacity: 1;
        }

        .normative-reference {
            background: #f4f0f7;
            border-left: 4px solid #9b59b6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .normative-reference h4 {
            color: #8e44ad;
            margin-bottom: 8px;
        }

        .normative-reference p {
            color: #34495e;
            font-size: 14px;
            margin: 0;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-activa { background: #27ae60; color: white; }
        .status-suspendida { background: #f39c12; color: white; }
        .status-caducada { background: #e74c3c; color: white; }
        .status-en-proceso { background: #3498db; color: white; }
        .status-renovada { background: #9b59b6; color: white; }

        .certificate-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 5px solid #9b59b6;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .certificate-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .certificate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .certificate-title {
            font-size: 18px;
            font-weight: bold;
            color: #9b59b6;
        }

        .certificate-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .certificate-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
        }

        .detail-value {
            color: #333;
        }

        @media (max-width: 768px) {
            .form-row, .form-row-3, .form-row-4 {
                grid-template-columns: 1fr;
            }
            
            .signature-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .container {
                margin: 10px;
                max-width: calc(100% - 20px);
            }

            .certificate-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="auto-save" id="autoSave">üíæ Guardado autom√°tico</div>
    
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">ASCH</div>
                    <div class="logo">OHLA</div>
                </div>
                <div class="title-section">
                    <h1 class="title">CERTIFICACIONES DE AUDITOR√çA</h1>
                    <p class="subtitle">Sistema Integral de Gesti√≥n de Certificaciones y Acreditaciones</p>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Informaci√≥n General -->
            <div class="section">
                <h2 class="section-title">Informaci√≥n General de la Certificaci√≥n</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigoCertificacion">C√≥digo de Certificaci√≥n:</label>
                        <input type="text" id="codigoCertificacion" readonly>
                    </div>
                    <div class="form-group">
                        <label for="fechaRegistro">Fecha de Registro:</label>
                        <input type="date" id="fechaRegistro">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoCertificacion">Tipo de Certificaci√≥n:</label>
                        <select id="tipoCertificacion">
                            <option value="">Seleccionar tipo</option>
                            <option value="iso-9001">ISO 9001:2015 - Gesti√≥n de Calidad</option>
                            <option value="iso-14001">ISO 14001:2015 - Gesti√≥n Ambiental</option>
                            <option value="iso-45001">ISO 45001:2018 - Seguridad y Salud</option>
                            <option value="iso-50001">ISO 50001:2018 - Gesti√≥n Energ√©tica</option>
                            <option value="iso-37001">ISO 37001:2016 - Antisoborno</option>
                            <option value="iso-22301">ISO 22301:2019 - Continuidad de Negocio</option>
                            <option value="ohsas-18001">OHSAS 18001:2007 - Seguridad y Salud</option>
                            <option value="emas">EMAS III - Eco-gesti√≥n y Auditor√≠a</option>
                            <option value="otra">Otra Certificaci√≥n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="organismoCertificador">Organismo Certificador:</label>
                        <select id="organismoCertificador">
                            <option value="">Seleccionar organismo</option>
                            <option value="aenor">AENOR - Asociaci√≥n Espa√±ola de Normalizaci√≥n</option>
                            <option value="bureau-veritas">Bureau Veritas</option>
                            <option value="sgs">SGS - Soci√©t√© G√©n√©rale de Surveillance</option>
                            <option value="tuv-sud">T√úV S√úD</option>
                            <option value="tuv-rheinland">T√úV Rheinland</option>
                            <option value="dnv-gl">DNV GL</option>
                            <option value="lloyd-register">Lloyd's Register</option>
                            <option value="intertek">Intertek</option>
                            <option value="otro">Otro Organismo</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="organizacion">Organizaci√≥n:</label>
                        <input type="text" id="organizacion" placeholder="Nombre de la organizaci√≥n">
                    </div>
                    <div class="form-group">
                        <label for="alcance">Alcance de la Certificaci√≥n:</label>
                        <input type="text" id="alcance" placeholder="Alcance espec√≠fico de la certificaci√≥n">
                    </div>
                </div>
            </div>

            <!-- Detalles de la Certificaci√≥n -->
            <div class="section">
                <h2 class="section-title">Detalles de la Certificaci√≥n</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="numeroCertificado">N√∫mero de Certificado:</label>
                        <input type="text" id="numeroCertificado" placeholder="N√∫mero oficial del certificado">
                    </div>
                    <div class="form-group">
                        <label for="fechaEmision">Fecha de Emisi√≥n:</label>
                        <input type="date" id="fechaEmision">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaVencimiento">Fecha de Vencimiento:</label>
                        <input type="date" id="fechaVencimiento">
                    </div>
                    <div class="form-group">
                        <label for="estadoCertificacion">Estado de la Certificaci√≥n:</label>
                        <select id="estadoCertificacion">
                            <option value="">Seleccionar estado</option>
                            <option value="activa">Activa</option>
                            <option value="suspendida">Suspendida</option>
                            <option value="caducada">Caducada</option>
                            <option value="en-proceso">En Proceso de Renovaci√≥n</option>
                            <option value="renovada">Renovada</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="descripcionCertificacion">Descripci√≥n de la Certificaci√≥n:</label>
                    <textarea id="descripcionCertificacion" placeholder="Descripci√≥n detallada de la certificaci√≥n y sus requisitos"></textarea>
                </div>

                <div class="form-group">
                    <label for="beneficiosCertificacion">Beneficios de la Certificaci√≥n:</label>
                    <textarea id="beneficiosCertificacion" placeholder="Beneficios obtenidos con la certificaci√≥n"></textarea>
                </div>
            </div>

            <!-- Proceso de Certificaci√≥n -->
            <div class="section">
                <h2 class="section-title">Proceso de Certificaci√≥n</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaInicioProceso">Fecha de Inicio del Proceso:</label>
                        <input type="date" id="fechaInicioProceso">
                    </div>
                    <div class="form-group">
                        <label for="fechaFinalizacionProceso">Fecha de Finalizaci√≥n:</label>
                        <input type="date" id="fechaFinalizacionProceso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="auditorLider">Auditor L√≠der:</label>
                        <input type="text" id="auditorLider" placeholder="Nombre del auditor l√≠der">
                    </div>
                    <div class="form-group">
                        <label for="equipoAuditoria">Equipo de Auditor√≠a:</label>
                        <input type="text" id="equipoAuditoria" placeholder="Miembros del equipo de auditor√≠a">
                    </div>
                </div>

                <div class="form-group">
                    <label for="metodologiaAuditoria">Metodolog√≠a de Auditor√≠a:</label>
                    <textarea id="metodologiaAuditoria" placeholder="Metodolog√≠a utilizada en el proceso de auditor√≠a"></textarea>
                </div>

                <div class="form-group">
                    <label for="hallazgosPrincipales">Hallazgos Principales:</label>
                    <textarea id="hallazgosPrincipales" placeholder="Principales hallazgos durante la auditor√≠a de certificaci√≥n"></textarea>
                </div>
            </div>

            <!-- Seguimiento y Renovaci√≥n -->
            <div class="section">
                <h2 class="section-title">Seguimiento y Renovaci√≥n</h2>
                
                <div class="form-row-4">
                    <div class="metric-card">
                        <div class="metric-number" id="diasRestantes">0</div>
                        <div class="metric-label">D√≠as Restantes</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="auditoriasRealizadas">0</div>
                        <div class="metric-label">Auditor√≠as Realizadas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="noConformidades">0</div>
                        <div class="metric-label">No Conformidades</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="porcentajeCumplimiento">0%</div>
                        <div class="metric-label">% Cumplimiento</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaProximaAuditoria">Fecha de Pr√≥xima Auditor√≠a:</label>
                        <input type="date" id="fechaProximaAuditoria">
                    </div>
                    <div class="form-group">
                        <label for="tipoProximaAuditoria">Tipo de Pr√≥xima Auditor√≠a:</label>
                        <select id="tipoProximaAuditoria">
                            <option value="">Seleccionar tipo</option>
                            <option value="seguimiento">Auditor√≠a de Seguimiento</option>
                            <option value="renovacion">Auditor√≠a de Renovaci√≥n</option>
                            <option value="recertificacion">Recertificaci√≥n</option>
                            <option value="ampliacion">Ampliaci√≥n de Alcance</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="planRenovacion">Plan de Renovaci√≥n:</label>
                    <textarea id="planRenovacion" placeholder="Plan detallado para la renovaci√≥n de la certificaci√≥n"></textarea>
                </div>

                <div class="form-group">
                    <label for="requisitosRenovacion">Requisitos para la Renovaci√≥n:</label>
                    <textarea id="requisitosRenovacion" placeholder="Requisitos espec√≠ficos para mantener o renovar la certificaci√≥n"></textarea>
                </div>
            </div>

            <!-- Historial de Auditor√≠as -->
            <div class="section">
                <h2 class="section-title">Historial de Auditor√≠as</h2>
                
                <div class="table-container">
                    <table id="auditoriasTable">
                        <thead>
                            <tr>
                                <th>N¬∫</th>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Auditor</th>
                                <th>Resultado</th>
                                <th>No Conformidades</th>
                                <th>Observaciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><input type="date" style="width: 120px;"></td>
                                <td>
                                    <select style="width: 120px;">
                                        <option value="">Tipo</option>
                                        <option value="inicial">Inicial</option>
                                        <option value="seguimiento">Seguimiento</option>
                                        <option value="renovacion">Renovaci√≥n</option>
                                        <option value="recertificacion">Recertificaci√≥n</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="Auditor" style="width: 150px;"></td>
                                <td>
                                    <select style="width: 100px;">
                                        <option value="">Resultado</option>
                                        <option value="favorable">Favorable</option>
                                        <option value="condicional">Condicional</option>
                                        <option value="desfavorable">Desfavorable</option>
                                    </select>
                                </td>
                                <td><input type="number" placeholder="0" style="width: 80px;"></td>
                                <td><input type="text" placeholder="Observaciones" style="width: 200px;"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button type="button" class="btn btn-secondary" onclick="addAuditoria()">+ A√±adir Auditor√≠a</button>
            </div>

            <!-- Documentaci√≥n -->
            <div class="section">
                <h2 class="section-title">Documentaci√≥n de la Certificaci√≥n</h2>
                
                <div class="form-group">
                    <label for="documentosCertificacion">Documentos de la Certificaci√≥n:</label>
                    <textarea id="documentosCertificacion" placeholder="Lista de documentos relacionados con la certificaci√≥n"></textarea>
                </div>

                <div class="form-group">
                    <label for="ubicacionDocumentos">Ubicaci√≥n de los Documentos:</label>
                    <input type="text" id="ubicacionDocumentos" placeholder="Ubicaci√≥n f√≠sica o digital de los documentos">
                </div>

                <div class="form-group">
                    <label for="responsableDocumentacion">Responsable de la Documentaci√≥n:</label>
                    <input type="text" id="responsableDocumentacion" placeholder="Nombre del responsable">
                </div>

                <div class="form-group">
                    <label for="fechaActualizacionDocumentos">Fecha de √öltima Actualizaci√≥n:</label>
                    <input type="date" id="fechaActualizacionDocumentos">
                </div>
            </div>

            <!-- Costos y Recursos -->
            <div class="section">
                <h2 class="section-title">Costos y Recursos</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="costoCertificacion">Costo de la Certificaci√≥n:</label>
                        <input type="number" id="costoCertificacion" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="costoRenovacion">Costo de Renovaci√≥n:</label>
                        <input type="number" id="costoRenovacion" placeholder="0.00" step="0.01">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="recursosHumanos">Recursos Humanos Asignados:</label>
                        <input type="text" id="recursosHumanos" placeholder="Personal asignado al proceso">
                    </div>
                    <div class="form-group">
                        <label for="recursosTecnicos">Recursos T√©cnicos:</label>
                        <input type="text" id="recursosTecnicos" placeholder="Recursos t√©cnicos necesarios">
                    </div>
                </div>

                <div class="form-group">
                    <label for="observacionesCostos">Observaciones sobre Costos:</label>
                    <textarea id="observacionesCostos" placeholder="Observaciones sobre costos y recursos"></textarea>
                </div>
            </div>

            <!-- Firmas y Aprobaciones -->
            <div class="signature-section">
                <h2 class="section-title">Firmas y Aprobaciones</h2>
                
                <div class="signature-grid">
                    <div class="signature-box">
                        <h4>Responsable de Certificaciones</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del responsable" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>
                    
                    <div class="signature-box">
                        <h4>Representante de la Direcci√≥n</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del representante" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>

                    <div class="signature-box">
                        <h4>Responsable de Calidad</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del responsable" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div style="text-align: center; margin-top: 40px;">
                <button type="button" class="btn" onclick="saveData()">üíæ Guardar Datos</button>
                <button type="button" class="btn btn-secondary" onclick="printDocument()">üñ®Ô∏è Imprimir</button>
                <button type="button" class="btn btn-success" onclick="exportData()">üì§ Exportar</button>
            </div>
        </div>
    </div>

    <script>
        // Generar c√≥digo autom√°tico
        function generateCode() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            return `CERT-AUD-${year}${month}${day}-${random}`;
        }

        // Inicializar c√≥digo
        document.getElementById('codigoCertificacion').value = generateCode();

        // Calcular d√≠as restantes
        function calculateDiasRestantes() {
            const fechaVencimiento = document.getElementById('fechaVencimiento').value;
            if (fechaVencimiento) {
                const hoy = new Date();
                const vencimiento = new Date(fechaVencimiento);
                const diffTime = vencimiento - hoy;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                document.getElementById('diasRestantes').textContent = diffDays > 0 ? diffDays : 0;
            }
        }

        // Calcular m√©tricas
        function calculateMetrics() {
            const rows = document.querySelectorAll('#auditoriasTable tbody tr');
            let auditoriasRealizadas = rows.length;
            let noConformidades = 0;
            let porcentajeCumplimiento = 0;

            rows.forEach(row => {
                const nc = parseInt(row.querySelector('td:nth-child(6) input').value) || 0;
                noConformidades += nc;
            });

            if (auditoriasRealizadas > 0) {
                porcentajeCumplimiento = Math.round(((auditoriasRealizadas - noConformidades) / auditoriasRealizadas) * 100);
            }

            document.getElementById('auditoriasRealizadas').textContent = auditoriasRealizadas;
            document.getElementById('noConformidades').textContent = noConformidades;
            document.getElementById('porcentajeCumplimiento').textContent = porcentajeCumplimiento + '%';
        }

        // A√±adir auditor√≠a
        function addAuditoria() {
            const table = document.getElementById('auditoriasTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            const rowNumber = table.rows.length;
            
            newRow.innerHTML = `
                <td>${rowNumber}</td>
                <td><input type="date" style="width: 120px;"></td>
                <td>
                    <select style="width: 120px;">
                        <option value="">Tipo</option>
                        <option value="inicial">Inicial</option>
                        <option value="seguimiento">Seguimiento</option>
                        <option value="renovacion">Renovaci√≥n</option>
                        <option value="recertificacion">Recertificaci√≥n</option>
                    </select>
                </td>
                <td><input type="text" placeholder="Auditor" style="width: 150px;"></td>
                <td>
                    <select style="width: 100px;">
                        <option value="">Resultado</option>
                        <option value="favorable">Favorable</option>
                        <option value="condicional">Condicional</option>
                        <option value="desfavorable">Desfavorable</option>
                    </select>
                </td>
                <td><input type="number" placeholder="0" style="width: 80px;"></td>
                <td><input type="text" placeholder="Observaciones" style="width: 200px;"></td>
            `;
            
            // A√±adir event listener para recalcular m√©tricas
            const input = newRow.querySelector('td:nth-child(6) input');
            input.addEventListener('input', calculateMetrics);
        }

        // Guardar datos
        function saveData() {
            const data = {
                codigoCertificacion: document.getElementById('codigoCertificacion').value,
                fechaRegistro: document.getElementById('fechaRegistro').value,
                tipoCertificacion: document.getElementById('tipoCertificacion').value,
                organismoCertificador: document.getElementById('organismoCertificador').value,
                organizacion: document.getElementById('organizacion').value,
                alcance: document.getElementById('alcance').value,
                numeroCertificado: document.getElementById('numeroCertificado').value,
                fechaEmision: document.getElementById('fechaEmision').value,
                fechaVencimiento: document.getElementById('fechaVencimiento').value,
                estadoCertificacion: document.getElementById('estadoCertificacion').value,
                descripcionCertificacion: document.getElementById('descripcionCertificacion').value,
                beneficiosCertificacion: document.getElementById('beneficiosCertificacion').value,
                fechaInicioProceso: document.getElementById('fechaInicioProceso').value,
                fechaFinalizacionProceso: document.getElementById('fechaFinalizacionProceso').value,
                auditorLider: document.getElementById('auditorLider').value,
                equipoAuditoria: document.getElementById('equipoAuditoria').value,
                metodologiaAuditoria: document.getElementById('metodologiaAuditoria').value,
                hallazgosPrincipales: document.getElementById('hallazgosPrincipales').value,
                fechaProximaAuditoria: document.getElementById('fechaProximaAuditoria').value,
                tipoProximaAuditoria: document.getElementById('tipoProximaAuditoria').value,
                planRenovacion: document.getElementById('planRenovacion').value,
                requisitosRenovacion: document.getElementById('requisitosRenovacion').value,
                documentosCertificacion: document.getElementById('documentosCertificacion').value,
                ubicacionDocumentos: document.getElementById('ubicacionDocumentos').value,
                responsableDocumentacion: document.getElementById('responsableDocumentacion').value,
                fechaActualizacionDocumentos: document.getElementById('fechaActualizacionDocumentos').value,
                costoCertificacion: document.getElementById('costoCertificacion').value,
                costoRenovacion: document.getElementById('costoRenovacion').value,
                recursosHumanos: document.getElementById('recursosHumanos').value,
                recursosTecnicos: document.getElementById('recursosTecnicos').value,
                observacionesCostos: document.getElementById('observacionesCostos').value,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('certificacionAuditoria_' + data.codigoCertificacion, JSON.stringify(data));
            showAutoSave();
            console.log('Datos de certificaci√≥n de auditor√≠a guardados correctamente');
        }

        // Mostrar auto-save
        function showAutoSave() {
            const autoSave = document.getElementById('autoSave');
            autoSave.classList.add('show');
            setTimeout(() => {
                autoSave.classList.remove('show');
            }, 2000);
        }

        // Imprimir documento
        function printDocument() {
            window.print();
        }

        // Exportar datos
        function exportData() {
            const data = {
                codigoCertificacion: document.getElementById('codigoCertificacion').value,
                fechaRegistro: document.getElementById('fechaRegistro').value,
                tipoCertificacion: document.getElementById('tipoCertificacion').value,
                // ... otros campos
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'certificacion_auditoria_' + data.codigoCertificacion + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Calcular d√≠as restantes cuando cambie la fecha de vencimiento
            document.getElementById('fechaVencimiento').addEventListener('change', calculateDiasRestantes);

            // Calcular m√©tricas cuando cambien las auditor√≠as
            document.querySelectorAll('#auditoriasTable tbody input').forEach(input => {
                input.addEventListener('input', calculateMetrics);
            });

            // Auto-save cada 30 segundos
            setInterval(saveData, 30000);

            // Cargar datos guardados si existen
            const codigo = document.getElementById('codigoCertificacion').value;
            const savedData = localStorage.getItem('certificacionAuditoria_' + codigo);
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });
            }
        });
    </script>
</body>
</html>
