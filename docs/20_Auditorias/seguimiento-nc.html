<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de No Conformidades - Sistema Integral</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideInUp 0.8s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .logo {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: bold;
            font-size: 18px;
            animation: logoGlow 3s ease-in-out infinite;
            min-width: 120px;
        }

        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,255,255,0.3); }
            50% { box-shadow: 0 0 30px rgba(255,255,255,0.6); }
        }

        .title-section {
            flex: 1;
            text-align: center;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #e74c3c;
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: 'üìã';
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #e74c3c;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .metric-number {
            font-size: 32px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .signature-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .signature-box {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px dashed #e74c3c;
        }

        .signature-line {
            border-bottom: 2px solid #333;
            margin: 40px 0 10px 0;
            height: 2px;
        }

        .auto-save {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .auto-save.show {
            opacity: 1;
        }

        .normative-reference {
            background: #fef2f2;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .normative-reference h4 {
            color: #c0392b;
            margin-bottom: 8px;
        }

        .normative-reference p {
            color: #34495e;
            font-size: 14px;
            margin: 0;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-abierta { background: #e74c3c; color: white; }
        .status-en-proceso { background: #f39c12; color: white; }
        .status-cerrada { background: #27ae60; color: white; }
        .status-reabierta { background: #9b59b6; color: white; }
        .status-archivada { background: #95a5a6; color: white; }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e74c3c;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            border: 3px solid white;
        }

        .timeline-date {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
        }

        .timeline-content {
            color: #555;
        }

        @media (max-width: 768px) {
            .form-row, .form-row-3, .form-row-4 {
                grid-template-columns: 1fr;
            }
            
            .signature-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .container {
                margin: 10px;
                max-width: calc(100% - 20px);
            }
        }
    </style>
</head>
<body>
    <div class="auto-save" id="autoSave">üíæ Guardado autom√°tico</div>
    
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">ASCH</div>
                    <div class="logo">OHLA</div>
                </div>
                <div class="title-section">
                    <h1 class="title">SEGUIMIENTO DE NO CONFORMIDADES</h1>
                    <p class="subtitle">Sistema Integral de Seguimiento y Control de No Conformidades</p>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Informaci√≥n General -->
            <div class="section">
                <h2 class="section-title">Informaci√≥n General de la No Conformidad</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigoNC">C√≥digo de No Conformidad:</label>
                        <input type="text" id="codigoNC" readonly>
                    </div>
                    <div class="form-group">
                        <label for="fechaRegistro">Fecha de Registro:</label>
                        <input type="date" id="fechaRegistro">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoNC">Tipo de No Conformidad:</label>
                        <select id="tipoNC">
                            <option value="">Seleccionar tipo</option>
                            <option value="mayor">No Conformidad Mayor</option>
                            <option value="menor">No Conformidad Menor</option>
                            <option value="observacion">Observaci√≥n</option>
                            <option value="oportunidad-mejora">Oportunidad de Mejora</option>
                            <option value="incumplimiento-legal">Incumplimiento Legal</option>
                            <option value="riesgo-calidad">Riesgo de Calidad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="origenNC">Origen de la No Conformidad:</label>
                        <select id="origenNC">
                            <option value="">Seleccionar origen</option>
                            <option value="auditoria-interna">Auditor√≠a Interna</option>
                            <option value="auditoria-externa">Auditor√≠a Externa</option>
                            <option value="inspeccion-cliente">Inspecci√≥n de Cliente</option>
                            <option value="autocontrol">Autocontrol</option>
                            <option value="queja-cliente">Queja de Cliente</option>
                            <option value="incidente">Incidente</option>
                            <option value="revision-direccion">Revisi√≥n por la Direcci√≥n</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="organizacion">Organizaci√≥n:</label>
                        <input type="text" id="organizacion" placeholder="Nombre de la organizaci√≥n">
                    </div>
                    <div class="form-group">
                        <label for="areaAfectada">√Årea Afectada:</label>
                        <input type="text" id="areaAfectada" placeholder="√Årea o departamento afectado">
                    </div>
                </div>
            </div>

            <!-- Descripci√≥n de la No Conformidad -->
            <div class="section">
                <h2 class="section-title">Descripci√≥n de la No Conformidad</h2>
                
                <div class="form-group">
                    <label for="descripcionNC">Descripci√≥n Detallada:</label>
                    <textarea id="descripcionNC" placeholder="Descripci√≥n detallada de la no conformidad identificada"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gravedad">Gravedad:</label>
                        <select id="gravedad">
                            <option value="">Seleccionar gravedad</option>
                            <option value="critica">Cr√≠tica</option>
                            <option value="alta">Alta</option>
                            <option value="media">Media</option>
                            <option value="baja">Baja</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="urgencia">Urgencia:</label>
                        <select id="urgencia">
                            <option value="">Seleccionar urgencia</option>
                            <option value="inmediata">Inmediata (24h)</option>
                            <option value="urgente">Urgente (72h)</option>
                            <option value="alta">Alta (1 semana)</option>
                            <option value="media">Media (2 semanas)</option>
                            <option value="baja">Baja (1 mes)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="evidencia">Evidencia Objetiva:</label>
                    <textarea id="evidencia" placeholder="Evidencia objetiva que sustenta la no conformidad"></textarea>
                </div>

                <div class="form-group">
                    <label for="normativaAfectada">Normativa Afectada:</label>
                    <textarea id="normativaAfectada" placeholder="Normativas, procedimientos o requisitos que se han incumplido"></textarea>
                </div>
            </div>

            <!-- An√°lisis de Causas -->
            <div class="section">
                <h2 class="section-title">An√°lisis de Causas Ra√≠z</h2>
                
                <div class="normative-reference">
                    <h4>üîç Metodolog√≠as de An√°lisis Aplicables:</h4>
                    <p><strong>5 Porqu√©s</strong> | <strong>Diagrama de Ishikawa</strong> | <strong>An√°lisis FODA</strong> | <strong>An√°lisis de Pareto</strong> | <strong>Brainstorming</strong></p>
                </div>

                <div class="form-group">
                    <label for="metodologiaAnalisis">Metodolog√≠a de An√°lisis Utilizada:</label>
                    <select id="metodologiaAnalisis">
                        <option value="">Seleccionar metodolog√≠a</option>
                        <option value="5-porques">5 Porqu√©s</option>
                        <option value="ishikawa">Diagrama de Ishikawa</option>
                        <option value="foda">An√°lisis FODA</option>
                        <option value="pareto">An√°lisis de Pareto</option>
                        <option value="brainstorming">Brainstorming</option>
                        <option value="otra">Otra metodolog√≠a</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="causasIdentificadas">Causas Identificadas:</label>
                    <textarea id="causasIdentificadas" placeholder="Descripci√≥n detallada de las causas ra√≠z identificadas"></textarea>
                </div>

                <div class="form-group">
                    <label for="responsableAnalisis">Responsable del An√°lisis:</label>
                    <input type="text" id="responsableAnalisis" placeholder="Nombre del responsable del an√°lisis">
                </div>
            </div>

            <!-- Plan de Acci√≥n Correctiva -->
            <div class="section">
                <h2 class="section-title">Plan de Acci√≥n Correctiva</h2>
                
                <div class="form-row-4">
                    <div class="metric-card">
                        <div class="metric-number" id="totalAcciones">0</div>
                        <div class="metric-label">Total Acciones</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="accionesPendientes">0</div>
                        <div class="metric-label">Pendientes</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="accionesEnProceso">0</div>
                        <div class="metric-label">En Proceso</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number" id="accionesCompletadas">0</div>
                        <div class="metric-label">Completadas</div>
                    </div>
                </div>

                <div class="table-container">
                    <table id="accionesTable">
                        <thead>
                            <tr>
                                <th>N¬∫</th>
                                <th>Acci√≥n Correctiva</th>
                                <th>Responsable</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha L√≠mite</th>
                                <th>Estado</th>
                                <th>Recursos</th>
                                <th>Evidencia</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><input type="text" placeholder="Descripci√≥n de la acci√≥n" style="width: 250px;"></td>
                                <td><input type="text" placeholder="Responsable" style="width: 150px;"></td>
                                <td><input type="date" style="width: 120px;"></td>
                                <td><input type="date" style="width: 120px;"></td>
                                <td>
                                    <select style="width: 120px;">
                                        <option value="">Estado</option>
                                        <option value="pendiente">Pendiente</option>
                                        <option value="en-proceso">En Proceso</option>
                                        <option value="implementada">Implementada</option>
                                        <option value="verificada">Verificada</option>
                                        <option value="cerrada">Cerrada</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="Recursos necesarios" style="width: 150px;"></td>
                                <td><input type="text" placeholder="Evidencia de cumplimiento" style="width: 180px;"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button type="button" class="btn btn-secondary" onclick="addAccion()">+ A√±adir Acci√≥n</button>
            </div>

            <!-- Seguimiento y Control -->
            <div class="section">
                <h2 class="section-title">Seguimiento y Control</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaSeguimiento">Fecha de Seguimiento:</label>
                        <input type="date" id="fechaSeguimiento">
                    </div>
                    <div class="form-group">
                        <label for="responsableSeguimiento">Responsable del Seguimiento:</label>
                        <input type="text" id="responsableSeguimiento" placeholder="Nombre del responsable">
                    </div>
                </div>

                <div class="form-group">
                    <label for="metodoSeguimiento">M√©todo de Seguimiento:</label>
                    <textarea id="metodoSeguimiento" placeholder="M√©todo utilizado para el seguimiento de la no conformidad"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="estadoActual">Estado Actual:</label>
                        <select id="estadoActual">
                            <option value="">Seleccionar estado</option>
                            <option value="abierta">Abierta</option>
                            <option value="en-proceso">En Proceso</option>
                            <option value="cerrada">Cerrada</option>
                            <option value="reabierta">Reabierta</option>
                            <option value="archivada">Archivada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fechaCierre">Fecha de Cierre (si aplica):</label>
                        <input type="date" id="fechaCierre">
                    </div>
                </div>

                <div class="form-group">
                    <label for="observacionesSeguimiento">Observaciones del Seguimiento:</label>
                    <textarea id="observacionesSeguimiento" placeholder="Observaciones y comentarios del seguimiento realizado"></textarea>
                </div>
            </div>

            <!-- Verificaci√≥n de Efectividad -->
            <div class="section">
                <h2 class="section-title">Verificaci√≥n de Efectividad</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaVerificacion">Fecha de Verificaci√≥n:</label>
                        <input type="date" id="fechaVerificacion">
                    </div>
                    <div class="form-group">
                        <label for="verificador">Verificador:</label>
                        <input type="text" id="verificador" placeholder="Nombre del verificador">
                    </div>
                </div>

                <div class="form-group">
                    <label for="metodoVerificacion">M√©todo de Verificaci√≥n:</label>
                    <textarea id="metodoVerificacion" placeholder="M√©todo utilizado para verificar la efectividad de las acciones implementadas"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="resultadoVerificacion">Resultado de la Verificaci√≥n:</label>
                        <select id="resultadoVerificacion">
                            <option value="">Seleccionar resultado</option>
                            <option value="efectiva">Efectiva</option>
                            <option value="parcialmente-efectiva">Parcialmente Efectiva</option>
                            <option value="no-efectiva">No Efectiva</option>
                            <option value="requiere-seguimiento">Requiere Seguimiento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fechaSeguimientoFuturo">Fecha de Seguimiento Futuro:</label>
                        <input type="date" id="fechaSeguimientoFuturo">
                    </div>
                </div>

                <div class="form-group">
                    <label for="evidenciaVerificacion">Evidencia de Verificaci√≥n:</label>
                    <textarea id="evidenciaVerificacion" placeholder="Evidencia que demuestra la efectividad de las acciones implementadas"></textarea>
                </div>
            </div>

            <!-- Historial de Seguimiento -->
            <div class="section">
                <h2 class="section-title">Historial de Seguimiento</h2>
                
                <div class="timeline" id="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">Fecha de Registro</div>
                        <div class="timeline-content">No conformidad registrada en el sistema</div>
                    </div>
                </div>
                
                <button type="button" class="btn btn-secondary" onclick="addTimelineItem()">+ A√±adir Entrada</button>
            </div>

            <!-- Cierre de la No Conformidad -->
            <div class="section">
                <h2 class="section-title">Cierre de la No Conformidad</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaCierreFinal">Fecha de Cierre Final:</label>
                        <input type="date" id="fechaCierreFinal">
                    </div>
                    <div class="form-group">
                        <label for="estadoFinal">Estado Final:</label>
                        <select id="estadoFinal">
                            <option value="">Seleccionar estado</option>
                            <option value="cerrada-efectiva">Cerrada - Efectiva</option>
                            <option value="cerrada-parcial">Cerrada - Parcialmente Efectiva</option>
                            <option value="cerrada-no-efectiva">Cerrada - No Efectiva</option>
                            <option value="en-seguimiento">En Seguimiento</option>
                            <option value="reabierta">Reabierta</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="leccionesAprendidas">Lecciones Aprendidas:</label>
                    <textarea id="leccionesAprendidas" placeholder="Lecciones aprendidas y mejoras identificadas durante el proceso"></textarea>
                </div>

                <div class="form-group">
                    <label for="recomendaciones">Recomendaciones para el Futuro:</label>
                    <textarea id="recomendaciones" placeholder="Recomendaciones para prevenir la recurrencia de la no conformidad"></textarea>
                </div>
            </div>

            <!-- Firmas y Aprobaciones -->
            <div class="signature-section">
                <h2 class="section-title">Firmas y Aprobaciones</h2>
                
                <div class="signature-grid">
                    <div class="signature-box">
                        <h4>Responsable de la NC</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del responsable" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>
                    
                    <div class="signature-box">
                        <h4>Responsable de Seguimiento</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del responsable" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>

                    <div class="signature-box">
                        <h4>Responsable de Calidad</h4>
                        <div class="signature-line"></div>
                        <p>Nombre y Firma</p>
                        <input type="text" placeholder="Nombre del responsable" style="margin-top: 10px; text-align: center; border: none; border-bottom: 1px solid #ccc;">
                    </div>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div style="text-align: center; margin-top: 40px;">
                <button type="button" class="btn" onclick="saveData()">üíæ Guardar Datos</button>
                <button type="button" class="btn btn-secondary" onclick="printDocument()">üñ®Ô∏è Imprimir</button>
                <button type="button" class="btn btn-success" onclick="exportData()">üì§ Exportar</button>
            </div>
        </div>
    </div>

    <script>
        // Generar c√≥digo autom√°tico
        function generateCode() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            return `NC-SEG-${year}${month}${day}-${random}`;
        }

        // Inicializar c√≥digo
        document.getElementById('codigoNC').value = generateCode();

        // Calcular m√©tricas de acciones
        function calculateAcciones() {
            const rows = document.querySelectorAll('#accionesTable tbody tr');
            let totalAcciones = rows.length;
            let accionesPendientes = 0;
            let accionesEnProceso = 0;
            let accionesCompletadas = 0;

            rows.forEach(row => {
                const estado = row.querySelector('td:nth-child(6) select').value;
                if (estado === 'pendiente') accionesPendientes++;
                else if (estado === 'en-proceso') accionesEnProceso++;
                else if (estado === 'implementada' || estado === 'verificada' || estado === 'cerrada') accionesCompletadas++;
            });

            document.getElementById('totalAcciones').textContent = totalAcciones;
            document.getElementById('accionesPendientes').textContent = accionesPendientes;
            document.getElementById('accionesEnProceso').textContent = accionesEnProceso;
            document.getElementById('accionesCompletadas').textContent = accionesCompletadas;
        }

        // A√±adir acci√≥n
        function addAccion() {
            const table = document.getElementById('accionesTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            const rowNumber = table.rows.length;
            
            newRow.innerHTML = `
                <td>${rowNumber}</td>
                <td><input type="text" placeholder="Descripci√≥n de la acci√≥n" style="width: 250px;"></td>
                <td><input type="text" placeholder="Responsable" style="width: 150px;"></td>
                <td><input type="date" style="width: 120px;"></td>
                <td><input type="date" style="width: 120px;"></td>
                <td>
                    <select style="width: 120px;">
                        <option value="">Estado</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en-proceso">En Proceso</option>
                        <option value="implementada">Implementada</option>
                        <option value="verificada">Verificada</option>
                        <option value="cerrada">Cerrada</option>
                    </select>
                </td>
                <td><input type="text" placeholder="Recursos necesarios" style="width: 150px;"></td>
                <td><input type="text" placeholder="Evidencia de cumplimiento" style="width: 180px;"></td>
            `;
            
            // A√±adir event listener para recalcular m√©tricas
            const select = newRow.querySelector('td:nth-child(6) select');
            select.addEventListener('change', calculateAcciones);
        }

        // A√±adir entrada al timeline
        function addTimelineItem() {
            const timeline = document.getElementById('timeline');
            const newItem = document.createElement('div');
            newItem.className = 'timeline-item';
            
            const fecha = prompt('Fecha del evento (YYYY-MM-DD):');
            const contenido = prompt('Descripci√≥n del evento:');
            
            if (fecha && contenido) {
                newItem.innerHTML = `
                    <div class="timeline-date">${fecha}</div>
                    <div class="timeline-content">${contenido}</div>
                `;
                timeline.appendChild(newItem);
            }
        }

        // Guardar datos
        function saveData() {
            const data = {
                codigoNC: document.getElementById('codigoNC').value,
                fechaRegistro: document.getElementById('fechaRegistro').value,
                tipoNC: document.getElementById('tipoNC').value,
                origenNC: document.getElementById('origenNC').value,
                organizacion: document.getElementById('organizacion').value,
                areaAfectada: document.getElementById('areaAfectada').value,
                descripcionNC: document.getElementById('descripcionNC').value,
                gravedad: document.getElementById('gravedad').value,
                urgencia: document.getElementById('urgencia').value,
                evidencia: document.getElementById('evidencia').value,
                normativaAfectada: document.getElementById('normativaAfectada').value,
                metodologiaAnalisis: document.getElementById('metodologiaAnalisis').value,
                causasIdentificadas: document.getElementById('causasIdentificadas').value,
                responsableAnalisis: document.getElementById('responsableAnalisis').value,
                fechaSeguimiento: document.getElementById('fechaSeguimiento').value,
                responsableSeguimiento: document.getElementById('responsableSeguimiento').value,
                metodoSeguimiento: document.getElementById('metodoSeguimiento').value,
                estadoActual: document.getElementById('estadoActual').value,
                fechaCierre: document.getElementById('fechaCierre').value,
                observacionesSeguimiento: document.getElementById('observacionesSeguimiento').value,
                fechaVerificacion: document.getElementById('fechaVerificacion').value,
                verificador: document.getElementById('verificador').value,
                metodoVerificacion: document.getElementById('metodoVerificacion').value,
                resultadoVerificacion: document.getElementById('resultadoVerificacion').value,
                fechaSeguimientoFuturo: document.getElementById('fechaSeguimientoFuturo').value,
                evidenciaVerificacion: document.getElementById('evidenciaVerificacion').value,
                fechaCierreFinal: document.getElementById('fechaCierreFinal').value,
                estadoFinal: document.getElementById('estadoFinal').value,
                leccionesAprendidas: document.getElementById('leccionesAprendidas').value,
                recomendaciones: document.getElementById('recomendaciones').value,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('seguimientoNC_' + data.codigoNC, JSON.stringify(data));
            showAutoSave();
            console.log('Datos de seguimiento de NC guardados correctamente');
        }

        // Mostrar auto-save
        function showAutoSave() {
            const autoSave = document.getElementById('autoSave');
            autoSave.classList.add('show');
            setTimeout(() => {
                autoSave.classList.remove('show');
            }, 2000);
        }

        // Imprimir documento
        function printDocument() {
            window.print();
        }

        // Exportar datos
        function exportData() {
            const data = {
                codigoNC: document.getElementById('codigoNC').value,
                fechaRegistro: document.getElementById('fechaRegistro').value,
                tipoNC: document.getElementById('tipoNC').value,
                // ... otros campos
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'seguimiento_nc_' + data.codigoNC + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Calcular m√©tricas cuando cambien las acciones
            document.querySelectorAll('#accionesTable tbody select').forEach(select => {
                select.addEventListener('change', calculateAcciones);
            });

            // Auto-save cada 30 segundos
            setInterval(saveData, 30000);

            // Cargar datos guardados si existen
            const codigo = document.getElementById('codigoNC').value;
            const savedData = localStorage.getItem('seguimientoNC_' + codigo);
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });
            }
        });
    </script>
</body>
</html>
